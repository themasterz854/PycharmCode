#!/usr/bin/python

from Crypto.Util.number import *
from flag import flag


def keygen(nbit):
    while True:
        p, q, r = [getPrime(nbit) for _ in range(3)]
        if isPrime(p + q + r):
            pubkey = (p * q * r, p + q + r)
            privkey = (p, q, r)
            return pubkey, privkey


def encrypt(msg, pubkey):
    enc = pow(bytes_to_long(msg.encode('utf-8')), 0x10001, pubkey[0] * pubkey[1])
    return enc


nbit = 512
pubkey, _ = keygen(nbit)
print('pubkey =', pubkey)

enc = encrypt(flag, pubkey)
print('enc =', enc)
# pubkey = (943806136150274447342751076255660898439761708585692165724811173054748066416104790587389220590668982054819546190971498325657726153675562194386174821124849245385412165554265922674205499230543820115628174692341660374540391511551063761313072486143531747230253892610780467661566397291483904603786171777551468856520271549944402711654931171452631547748620270343743795052314000670041535076987883504378061810083333970037256151755962158127534953594208210597767795943527197, 29794330078517907772041933656388198618442220761091866471244371058871967485532112231819638696379271228560526736911535689649092392499564869938436359414731583)
# enc = 9823234030982677779536207302241627681091302679299752322049012547087006851491356000405630930179798218356058256886209826572621396270873411737988140190374276368268976029828656571710335304882442744121204655731601111043358317050851781011406343438936972953518680372274371919689499503767351436004078814000671923494497332150504411586964616596881118353574610454988014052025724180037741710361889766848891993097863553167521023791069329893429318724911080971440510120154534624459433193931474489317181446753517742213402447923207562321996806580029588847250507819741788968386520396239754032912032478476693897464048448132982672805429
